{% extends "base.html" %}
{% block title %}CareerCraft{% endblock %}
{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='styles/quiz.css') }}" />
{% endblock %}
{% block content %}
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<div class="container mt-4">
    {% for skill in data.skills %}
        {% for question in skill.questions %}
            <div class="question mb-5">
                <p><strong>{{ question.question }}</strong></p>
                {% for option in question.correct + question.wrong %}
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="{{ skill.skill }}-{{ question }}" value="{{ option }}" id="{{ skill.skill }}-{{ loop.index }}">
                        <label class="form-check-label" for="{{ skill.skill }}-{{ loop.index }}-{{ loop.index0 }}">
                            {{ option }}
                        </label>
                    </div>
                {% endfor %}
            </div>
        {% endfor %}
    {% endfor %}
    <button type="button" class="btn btn-success" id="submit-btn">Submit</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    $('#submit-btn').click(() => {
        const selectedOptions = document.querySelectorAll('input[type="radio"]:checked');
        let answers = {};
        selectedOptions.forEach((option, ind) => {
            console.log(option.id);
            answers[ind] = option.value;
        });

        $.ajax({
            url: `{{ url_for('activity.process_quiz', project_id = project_id) }}`, // Ensure project_id is defined and passed correctly
            type: 'POST', // Assuming you are sending data to the server
            contentType: 'application/json', // Indicate the type of data being sent
            data: JSON.stringify(answers), // Convert answers object to JSON string
            dataType: 'json', // Expected data type from the server
            success: function(data) {
                console.log('Success:', data);
                // Handle success scenario
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.error('Error:', textStatus, errorThrown);
                // Handle error scenario
            }
        });
    });
</script>
{% endblock %}
